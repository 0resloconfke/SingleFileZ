!function(){"use strict";const n=globalThis.document;if(n instanceof globalThis.Document){const e=n.createElement("script");e.src="data:,("+function(){"undefined"==typeof globalThis&&(window.globalThis=window);const n=globalThis.document,e=globalThis.console,t=n=>globalThis.dispatchEvent(n),r=globalThis.CustomEvent,i=globalThis.FileReader,o=globalThis.Blob,c=e&&e.warn&&((...n)=>e.warn(...n))||(()=>{}),u="single-filez-new-font-face",s="single-filez-delete-font",f="single-filez-clear-fonts",l={family:"font-family",style:"font-style",weight:"font-weight",stretch:"font-stretch",unicodeRange:"unicode-range",variant:"font-variant",featureSettings:"font-feature-settings"};if(globalThis.FontFace){const e=globalThis.FontFace;let i;globalThis.FontFace=function(){return i||(c("SingleFileZ is hooking the FontFace constructor, document.fonts.delete and document.fonts.clear to handle dynamically loaded fonts."),i=!0),a(...arguments).then((n=>t(new r(u,{detail:n})))),new e(...arguments)},globalThis.FontFace.toString=function(){return"function FontFace() { [native code] }"};const o=n.fonts.delete;n.fonts.delete=function(e){return a(e.family).then((n=>t(new r(s,{detail:n})))),o.call(n.fonts,e)},n.fonts.delete.toString=function(){return"function delete() { [native code] }"};const l=n.fonts.clear;n.fonts.clear=function(){return t(new r(f)),l.call(n.fonts)},n.fonts.clear.toString=function(){return"function clear() { [native code] }"}}async function a(n,e,t){const r={};return r["font-family"]=n,r.src=e,t&&Object.keys(t).forEach((n=>{l[n]&&(r[l[n]]=t[n])})),new Promise((n=>{if(r.src instanceof ArrayBuffer){const e=new i;e.readAsDataURL(new o([r.src])),e.addEventListener("load",(()=>{r.src="url("+e.result+")",n(r)}))}else n(r)}))}}.toString()+")()",(n.documentElement||n).appendChild(e),e.remove()}const e=globalThis.browser,t=globalThis.document;if(t instanceof globalThis.Document&&e&&e.runtime&&e.runtime.getURL){const n=t.createElement("script");n.src=e.runtime.getURL("/lib/single-file-hooks-frames.js"),n.async=!1,(t.documentElement||t).appendChild(n),n.remove()}const r=[0],i=Symbol(),o=new TextEncoder,c=new TextDecoder,u=new Array(256);let s=0;function f(n,e,t,i){if(void 0===i){if(s++,!(u.length-s>=r.length))throw new Error("Reached maximum number of custom types");u[u.length-s]={serialize:n,parse:e,test:t}}else u[i]={serialize:n,parse:e,test:t}}function*l(n,e){const t=u.findIndex((({test:t}={})=>t&&t(e,n)));n.addObject(e),yield*n.append(new Uint8Array([t]));const r=u[t].serialize;r&&(yield*r(n,e)),0!=t&&U(e)&&(yield*function*(n,e){const t=Object.getOwnPropertySymbols(e).map((n=>[n,e[n]]));yield*a(n,t)}(n,e),yield*function*(n,e){let t=Object.entries(e);F(e)&&(t=t.filter((([n])=>!I(Number(n)))));yield*function*(n,e){yield*l(n,e.length);for(const[t,r]of e)yield*d(n,t),yield*l(n,r)}(n,t)}(n,e))}function*a(n,e){yield*l(n,e.length);const t=Object.keys(e).filter((n=>I(Number(n)))).map((n=>Number(n)));let r=0,o=t[r];for(const[c,u]of e.entries())o==c?(o=t[++r],yield*l(n,u)):yield*l(n,i)}function*d(n,e){const t=o.encode(e);yield*l(n,t.length),yield*n.append(t)}function*y(n,e){yield*l(n,e.length),yield*n.append(new Uint8Array(e.buffer))}function*w(n,e){const t=new Uint8Array(new Float64Array([e]).buffer);yield*n.append(t)}function*m(n,e){const t=new Uint8Array([Number(e)]);yield*n.append(t)}f((function*(n,e){const t=n.objects.indexOf(e);yield*l(n,t)}),(function*(n){const e=yield*h(n);return new b(e,n)}),(function(n,e){return U(n)&&e.objects.includes(n)}),0),f(null,(function*(){return{}}),U),f(a,g,F),f(d,p,(function(n){return"string"==typeof n})),f(y,(function*(n){const e=yield*h(n),t=yield*n.consume(8*e);return new Float64Array(t.buffer)}),(function(n){return n instanceof Float64Array})),f(y,(function*(n){const e=yield*h(n),t=yield*n.consume(4*e);return new Float32Array(t.buffer)}),(function(n){return n instanceof Float32Array})),f(y,(function*(n){const e=yield*h(n),t=yield*n.consume(4*e);return new Uint32Array(t.buffer)}),(function(n){return n instanceof Uint32Array})),f(y,(function*(n){const e=yield*h(n),t=yield*n.consume(4*e);return new Int32Array(t.buffer)}),(function(n){return n instanceof Int32Array})),f(y,(function*(n){const e=yield*h(n),t=yield*n.consume(2*e);return new Uint16Array(t.buffer)}),(function(n){return n instanceof Uint16Array})),f(y,(function*(n){const e=yield*h(n),t=yield*n.consume(2*e);return new Int16Array(t.buffer)}),(function(n){return n instanceof Int16Array})),f(y,(function*(n){const e=yield*h(n),t=yield*n.consume(e);return new Uint8ClampedArray(t.buffer)}),(function(n){return n instanceof Uint8ClampedArray})),f(y,(function*(n){const e=yield*h(n);return yield*n.consume(e)}),(function(n){return n instanceof Uint8Array})),f(y,(function*(n){const e=yield*h(n),t=yield*n.consume(e);return new Int8Array(t.buffer)}),(function(n){return n instanceof Int8Array})),f((function*(n,e){yield*l(n,e.byteLength),yield*n.append(new Uint8Array(e))}),(function*(n){const e=yield*h(n);return(yield*n.consume(e)).buffer}),(function(n){return n instanceof ArrayBuffer})),f(w,A,E),f((function*(n,e){const t=new Uint8Array(new Uint32Array([e]).buffer);yield*n.append(t)}),(function*(n){const e=yield*n.consume(4);return new Uint32Array(e.buffer)[0]}),(function(n){return I(n)&&n>=0&&n<=4294967295})),f((function*(n,e){const t=new Uint8Array(new Int32Array([e]).buffer);yield*n.append(t)}),(function*(n){const e=yield*n.consume(4);return new Int32Array(e.buffer)[0]}),(function(n){return I(n)&&n>=-2147483648&&n<=2147483647})),f((function*(n,e){const t=new Uint8Array(new Uint16Array([e]).buffer);yield*n.append(t)}),(function*(n){const e=yield*n.consume(2);return new Uint16Array(e.buffer)[0]}),(function(n){return I(n)&&n>=0&&n<=65535})),f((function*(n,e){const t=new Uint8Array(new Int16Array([e]).buffer);yield*n.append(t)}),(function*(n){const e=yield*n.consume(2);return new Int16Array(e.buffer)[0]}),(function(n){return I(n)&&n>=-32768&&n<=32767})),f((function*(n,e){const t=new Uint8Array([e]);yield*n.append(t)}),(function*(n){const e=yield*n.consume(1);return new Uint8Array(e.buffer)[0]}),(function(n){return I(n)&&n>=0&&n<=255})),f((function*(n,e){const t=new Uint8Array(new Int8Array([e]).buffer);yield*n.append(t)}),(function*(n){const e=yield*n.consume(1);return new Int8Array(e.buffer)[0]}),(function(n){return I(n)&&n>=-128&&n<=127})),f(null,(function*(){return}),(function(n){return void 0===n})),f(null,(function*(){return null}),(function(n){return null===n})),f(null,(function*(){return NaN}),(function(n){return Number.isNaN(n)})),f(m,v,(function(n){return"boolean"==typeof n})),f((function*(n,e){yield*d(n,e.description)}),(function*(n){const e=yield*p(n);return Symbol(e)}),(function(n){return"symbol"==typeof n})),f(null,(function*(){return i}),T),f((function*(n,e){const t=e.entries();yield*l(n,e.size);for(const[e,r]of t)yield*l(n,e),yield*l(n,r)}),(function*(n){const e=yield*h(n),t=new Map;for(let r=0;r<e;r++){const e=yield*h(n),r=yield*h(n);n.setObject([e,r],((n,e)=>t.set(n,e)))}return t}),(function(n){return n instanceof Map})),f((function*(n,e){yield*l(n,e.size);for(const t of e)yield*l(n,t)}),(function*(n){const e=yield*h(n),t=new Set;for(let r=0;r<e;r++){const e=yield*h(n);n.setObject([e],(n=>t.add(n)))}return t}),(function(n){return n instanceof Set})),f((function*(n,e){yield*w(n,e.getTime())}),(function*(n){const e=yield*A(n);return new Date(e)}),(function(n){return n instanceof Date})),f((function*(n,e){yield*d(n,e.message),yield*d(n,e.stack)}),(function*(n){const e=yield*p(n),t=yield*p(n),r=new Error(e);return r.stack=t,r}),(function(n){return n instanceof Error})),f((function*(n,e){yield*d(n,e.source),yield*d(n,e.flags)}),(function*(n){const e=yield*p(n),t=yield*p(n);return new RegExp(e,t)}),(function(n){return n instanceof RegExp})),f((function*(n,e){yield*d(n,e.valueOf())}),(function*(n){return new String(yield*p(n))}),(function(n){return n instanceof String})),f((function*(n,e){yield*w(n,e.valueOf())}),(function*(n){return new Number(yield*A(n))}),(function(n){return n instanceof Number})),f((function*(n,e){yield*m(n,e.valueOf())}),(function*(n){return new Boolean(yield*v(n))}),(function(n){return n instanceof Boolean}));class b{constructor(n,e){this.index=n,this.data=e}getObject(){return this.data.objects[this.index]}}function*h(n){const e=(yield*n.consume(1))[0],t=u[e].parse,r=n.getObjectId(),i=yield*t(n);return 0!=e&&U(i)&&(yield*function*(n,e){const t=yield*g(n);n.setObject([t],(n=>n.forEach((([n,t])=>e[n]=t))))}(n,i),yield*function*(n,e){yield*function*(n,e){const t=yield*h(n);for(let r=0;r<t;r++){const t=yield*p(n),r=yield*h(n);n.setObject([r],(n=>e[t]=n))}}(n,e)}(n,i)),n.resolveObject(r,i),i}function*g(n){const e=yield*h(n),t=new Array(e);for(let r=0;r<e;r++){const e=yield*h(n);T(e)||n.setObject([e],(n=>t[r]=n))}return t}function*p(n){const e=yield*h(n),t=yield*n.consume(e);return c.decode(t)}function*A(n){const e=yield*n.consume(8);return new Float64Array(e.buffer)[0]}function*v(n){const e=yield*n.consume(1);return Boolean(e[0])}function U(n){return n===Object(n)}function F(n){return"number"==typeof n.length}function T(n){return n===i}function E(n){return"number"==typeof n}function I(n){return E(n)&&Number.isInteger(n)}const j="single-filez-response-fetch";let O=new Map;function S(n){return new Promise(((e,t)=>{var r,i,o,c;r=new CustomEvent("single-filez-request-fetch",{detail:n}),window.dispatchEvent(r),i=j,o=function r(i){var o,c,u;i.detail?i.detail.url==n&&(o=j,c=r,u=!1,window.removeEventListener(o,c,u),i.detail.response?e({status:i.detail.status,headers:new Map(i.detail.headers),arrayBuffer:async()=>i.detail.response}):t(i.detail.error)):t()},c=!1,window.addEventListener(i,o,c)}))}browser.runtime.onMessage.addListener((n=>"singlefile.fetchFrame"==n.method&&window.frameId&&window.frameId==n.frameId?async function(n){try{let r=await(e=n.url,t={cache:"force-cache",headers:n.headers},window.fetch(e,t));return 401!=r.status&&403!=r.status&&404!=r.status||(r=await Promise.race([S(n.url),new Promise(((n,e)=>setTimeout((()=>e()),5e3)))])),{status:r.status,headers:[...r.headers],array:Array.from(new Uint8Array(await r.arrayBuffer()))}}catch(n){return{error:n&&n.toString()}}var e,t}(n):"singlefile.fetchResponse"==n.method?async function(n){let e=O.get(n.requestId);if(e){const t=e.parser.next(n.data);if(t.done){O.delete(n.requestId);const r=t.value;r.error?e.reject(new Error(r.error)):e.resolve({status:r.status,headers:{get:n=>r.headers&&r.headers[n]},arrayBuffer:async()=>r.array.buffer})}}return{}}(n):void 0))}();
