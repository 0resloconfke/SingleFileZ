!function(){"use strict";const n=globalThis.document;if(n instanceof globalThis.Document){const e=n.createElement("script");e.src="data:,("+function(){"undefined"==typeof globalThis&&(window.globalThis=window);const n=globalThis.document,e=globalThis.console,t=n=>globalThis.dispatchEvent(n),r=globalThis.CustomEvent,o=globalThis.FileReader,i=globalThis.Blob,c=e&&e.warn&&((...n)=>e.warn(...n))||(()=>{}),u="single-filez-new-font-face",f="single-filez-delete-font",s="single-filez-clear-fonts",l={family:"font-family",style:"font-style",weight:"font-weight",stretch:"font-stretch",unicodeRange:"unicode-range",variant:"font-variant",featureSettings:"font-feature-settings"};if(globalThis.FontFace){const e=globalThis.FontFace;let o;globalThis.FontFace=function(){return o||(c("SingleFileZ is hooking the FontFace constructor, document.fonts.delete and document.fonts.clear to handle dynamically loaded fonts."),o=!0),a(...arguments).then((n=>t(new r(u,{detail:n})))),new e(...arguments)},globalThis.FontFace.toString=function(){return"function FontFace() { [native code] }"};const i=n.fonts.delete;n.fonts.delete=function(e){return a(e.family).then((n=>t(new r(f,{detail:n})))),i.call(n.fonts,e)},n.fonts.delete.toString=function(){return"function delete() { [native code] }"};const l=n.fonts.clear;n.fonts.clear=function(){return t(new r(s)),l.call(n.fonts)},n.fonts.clear.toString=function(){return"function clear() { [native code] }"}}async function a(n,e,t){const r={};return r["font-family"]=n,r.src=e,t&&Object.keys(t).forEach((n=>{l[n]&&(r[l[n]]=t[n])})),new Promise((n=>{if(r.src instanceof ArrayBuffer){const e=new o;e.readAsDataURL(new i([r.src])),e.addEventListener("load",(()=>{r.src="url("+e.result+")",n(r)}))}else n(r)}))}}.toString()+")()",(n.documentElement||n).appendChild(e),e.remove()}const e=globalThis.browser,t=globalThis.document;if(t instanceof globalThis.Document&&e&&e.runtime&&e.runtime.getURL){const n=t.createElement("script");n.src=e.runtime.getURL("/lib/single-file-hooks-frames.js"),n.async=!1,(t.documentElement||t).appendChild(n),n.remove()}const r=[0],o=Symbol(),i=new TextEncoder,c=new TextDecoder,u=new Array(256);let f=0;function s(n,e,t,o){if(void 0===o){if(f++,!(u.length-f>=r.length))throw new Error("Reached maximum number of custom types");u[u.length-f]={serialize:n,parse:e,test:t}}else u[o]={serialize:n,parse:e,test:t}}function*l(n,e){const t=u.findIndex((({test:t}={})=>t&&t(e,n)));n.addObject(e),yield*n.append(new Uint8Array([t]));const r=u[t].serialize;r&&(yield*r(n,e)),0!=t&&F(e)&&(yield*function*(n,e){const t=Object.getOwnPropertySymbols(e).map((n=>[n,e[n]]));yield*a(n,t)}(n,e),yield*function*(n,e){let t=Object.entries(e);v(e)&&(t=t.filter((([n])=>!j(Number(n)))));yield*function*(n,e){yield*l(n,e.length);for(const[t,r]of e)yield*d(n,t),yield*l(n,r)}(n,t)}(n,e))}function*a(n,e){yield*l(n,e.length);const t=Object.keys(e).filter((n=>j(Number(n)))).map((n=>Number(n)));let r=0,i=t[r];for(const[c,u]of e.entries())i==c?(i=t[++r],yield*l(n,u)):yield*l(n,o)}function*d(n,e){const t=i.encode(e);yield*l(n,t.length),yield*n.append(t)}function*y(n,e){yield*l(n,e.length),yield*n.append(new Uint8Array(e.buffer))}function*b(n,e){const t=new Uint8Array(new Float64Array([e]).buffer);yield*n.append(t)}function*m(n,e){const t=new Uint8Array([Number(e)]);yield*n.append(t)}s((function*(n,e){const t=n.objects.indexOf(e);yield*l(n,t)}),(function*(n){const e=yield*g(n);return new w(e,n)}),(function(n,e){return F(n)&&e.objects.includes(n)}),0),s(null,(function*(){return{}}),F),s(a,h,v),s(d,p,(function(n){return"string"==typeof n})),s(y,(function*(n){const e=yield*g(n),t=yield*n.consume(8*e);return new Float64Array(t.buffer)}),(function(n){return n instanceof Float64Array})),s(y,(function*(n){const e=yield*g(n),t=yield*n.consume(4*e);return new Float32Array(t.buffer)}),(function(n){return n instanceof Float32Array})),s(y,(function*(n){const e=yield*g(n),t=yield*n.consume(4*e);return new Uint32Array(t.buffer)}),(function(n){return n instanceof Uint32Array})),s(y,(function*(n){const e=yield*g(n),t=yield*n.consume(4*e);return new Int32Array(t.buffer)}),(function(n){return n instanceof Int32Array})),s(y,(function*(n){const e=yield*g(n),t=yield*n.consume(2*e);return new Uint16Array(t.buffer)}),(function(n){return n instanceof Uint16Array})),s(y,(function*(n){const e=yield*g(n),t=yield*n.consume(2*e);return new Int16Array(t.buffer)}),(function(n){return n instanceof Int16Array})),s(y,(function*(n){const e=yield*g(n),t=yield*n.consume(e);return new Uint8ClampedArray(t.buffer)}),(function(n){return n instanceof Uint8ClampedArray})),s(y,(function*(n){const e=yield*g(n);return yield*n.consume(e)}),(function(n){return n instanceof Uint8Array})),s(y,(function*(n){const e=yield*g(n),t=yield*n.consume(e);return new Int8Array(t.buffer)}),(function(n){return n instanceof Int8Array})),s((function*(n,e){yield*l(n,e.byteLength),yield*n.append(new Uint8Array(e))}),(function*(n){const e=yield*g(n);return(yield*n.consume(e)).buffer}),(function(n){return n instanceof ArrayBuffer})),s(b,A,T),s((function*(n,e){const t=new Uint8Array(new Uint32Array([e]).buffer);yield*n.append(t)}),(function*(n){const e=yield*n.consume(4);return new Uint32Array(e.buffer)[0]}),(function(n){return j(n)&&n>=0&&n<=4294967295})),s((function*(n,e){const t=new Uint8Array(new Int32Array([e]).buffer);yield*n.append(t)}),(function*(n){const e=yield*n.consume(4);return new Int32Array(e.buffer)[0]}),(function(n){return j(n)&&n>=-2147483648&&n<=2147483647})),s((function*(n,e){const t=new Uint8Array(new Uint16Array([e]).buffer);yield*n.append(t)}),(function*(n){const e=yield*n.consume(2);return new Uint16Array(e.buffer)[0]}),(function(n){return j(n)&&n>=0&&n<=65535})),s((function*(n,e){const t=new Uint8Array(new Int16Array([e]).buffer);yield*n.append(t)}),(function*(n){const e=yield*n.consume(2);return new Int16Array(e.buffer)[0]}),(function(n){return j(n)&&n>=-32768&&n<=32767})),s((function*(n,e){const t=new Uint8Array([e]);yield*n.append(t)}),(function*(n){const e=yield*n.consume(1);return new Uint8Array(e.buffer)[0]}),(function(n){return j(n)&&n>=0&&n<=255})),s((function*(n,e){const t=new Uint8Array(new Int8Array([e]).buffer);yield*n.append(t)}),(function*(n){const e=yield*n.consume(1);return new Int8Array(e.buffer)[0]}),(function(n){return j(n)&&n>=-128&&n<=127})),s(null,(function*(){return}),(function(n){return void 0===n})),s(null,(function*(){return null}),(function(n){return null===n})),s(null,(function*(){return NaN}),(function(n){return Number.isNaN(n)})),s(m,U,(function(n){return"boolean"==typeof n})),s((function*(n,e){yield*d(n,e.description)}),(function*(n){const e=yield*p(n);return Symbol(e)}),(function(n){return"symbol"==typeof n})),s(null,(function*(){return o}),I),s((function*(n,e){const t=e.entries();yield*l(n,e.size);for(const[e,r]of t)yield*l(n,e),yield*l(n,r)}),(function*(n){const e=yield*g(n),t=new Map;for(let r=0;r<e;r++){const e=yield*g(n),r=yield*g(n);n.setObject([e,r],((n,e)=>t.set(n,e)))}return t}),(function(n){return n instanceof Map})),s((function*(n,e){yield*l(n,e.size);for(const t of e)yield*l(n,t)}),(function*(n){const e=yield*g(n),t=new Set;for(let r=0;r<e;r++){const e=yield*g(n);n.setObject([e],(n=>t.add(n)))}return t}),(function(n){return n instanceof Set})),s((function*(n,e){yield*b(n,e.getTime())}),(function*(n){const e=yield*A(n);return new Date(e)}),(function(n){return n instanceof Date})),s((function*(n,e){yield*d(n,e.message),yield*d(n,e.stack)}),(function*(n){const e=yield*p(n),t=yield*p(n),r=new Error(e);return r.stack=t,r}),(function(n){return n instanceof Error})),s((function*(n,e){yield*d(n,e.source),yield*d(n,e.flags)}),(function*(n){const e=yield*p(n),t=yield*p(n);return new RegExp(e,t)}),(function(n){return n instanceof RegExp})),s((function*(n,e){yield*d(n,e.valueOf())}),(function*(n){return new String(yield*p(n))}),(function(n){return n instanceof String})),s((function*(n,e){yield*b(n,e.valueOf())}),(function*(n){return new Number(yield*A(n))}),(function(n){return n instanceof Number})),s((function*(n,e){yield*m(n,e.valueOf())}),(function*(n){return new Boolean(yield*U(n))}),(function(n){return n instanceof Boolean}));class w{constructor(n,e){this.index=n,this.data=e}getObject(){return this.data.objects[this.index]}}function*g(n){const e=(yield*n.consume(1))[0],t=u[e].parse,r=n.getObjectId(),o=yield*t(n);return 0!=e&&F(o)&&(yield*function*(n,e){const t=yield*h(n);n.setObject([t],(n=>n.forEach((([n,t])=>e[n]=t))))}(n,o),yield*function*(n,e){yield*function*(n,e){const t=yield*g(n);for(let r=0;r<t;r++){const t=yield*p(n),r=yield*g(n);n.setObject([r],(n=>e[t]=n))}}(n,e)}(n,o)),n.resolveObject(r,o),o}function*h(n){const e=yield*g(n),t=new Array(e);for(let r=0;r<e;r++){const e=yield*g(n);I(e)||n.setObject([e],(n=>t[r]=n))}return t}function*p(n){const e=yield*g(n),t=yield*n.consume(e);return c.decode(t)}function*A(n){const e=yield*n.consume(8);return new Float64Array(e.buffer)[0]}function*U(n){const e=yield*n.consume(1);return Boolean(e[0])}function F(n){return n===Object(n)}function v(n){return"number"==typeof n.length}function I(n){return n===o}function T(n){return"number"==typeof n}function j(n){return T(n)&&Number.isInteger(n)}let O=new Map;browser.runtime.onMessage.addListener((n=>"singlefile.fetchFrame"==n.method&&window.frameId&&window.frameId==n.frameId?async function(n){try{const r=await(e=n.url,t={cache:"force-cache",headers:n.headers},window.fetch(e,t));return{status:r.status,headers:[...r.headers],array:Array.from(new Uint8Array(await r.arrayBuffer()))}}catch(n){return{error:n&&n.toString()}}var e,t}(n):"singlefile.fetchResponse"==n.method?async function(n){let e=O.get(n.requestId);if(e){const t=e.parser.next(n.data);if(t.done){O.delete(n.requestId);const r=t.value;r.error?e.reject(new Error(r.error)):e.resolve({status:r.status,headers:{get:n=>r.headers&&r.headers[n]},arrayBuffer:async()=>r.array.buffer})}}return{}}(n):void 0))}();
