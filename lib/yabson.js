!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).yabson={})}(this,(function(e){"use strict";const n=new TextEncoder,t=new TextDecoder,r=new Array(256);let i=0;function s(e,n,t){i++,r[r.length-i]={serialize:e,parse:n,test:t}}s(a,E,se),s(f,F,oe),s(c,S,ue),s(l,j,ae),s(l,T,fe),s(l,D,ce),s(l,M,pe),s(l,O,le),s(l,R,ye),s(l,C,de),s(l,k,Ae),s(l,P,he),s(l,V,ge),s(l,_,we),s(y,q,Ue),s(d,G,be),s(p,H,me),s(A,J,Ie),s(h,K,ze),s(g,L,ve),s(w,Q,Be),s(U,W,Ne),s(null,X,Ee),s(null,Y,Fe),s(null,Z,Se),s(b,$,je),s(m,ee,Te),s(I,ne,De),s(z,te,Me),s(v,re,Oe),s(B,ie,Re);class o{constructor(e){this.offset=0,this.value=new Uint8Array(e)}*append(e){if(this.pending){const n=this.pending;this.pending=null,this.offset=0,this.value=new Uint8Array(this.value.length),yield*this.append(n),yield*this.append(e)}else this.offset+e.length>this.value.length?(this.value.set(e.subarray(0,this.value.length-this.offset),this.offset),this.pending=e.subarray(this.value.length-this.offset),yield this.value):(this.value.set(e,this.offset),this.offset+=e.length)}}function*u(e,n){const t=r.findIndex((({test:e}={})=>e&&e(n)));yield*e.append(new Uint8Array([t]));const i=r[t].serialize;i&&(yield*i(e,n))}function*a(e,n){const t=Object.entries(n);yield*u(e,t.length);for(const[n,r]of t)yield*c(e,n),yield*u(e,r)}function*f(e,n){yield*u(e,n.length);for(const t of n)yield*u(e,t)}function*c(e,t){const r=n.encode(t);yield*u(e,r.length),yield*e.append(r)}function*l(e,n){yield*u(e,n.length),yield*e.append(new Uint8Array(n.buffer))}function*y(e,n){const t=new Uint8Array(new Float64Array([n]).buffer);yield*e.append(t)}function*d(e,n){const t=new Uint8Array(new BigInt64Array([n]).buffer);yield*e.append(t)}function*p(e,n){const t=new Uint8Array(new Uint32Array([n]).buffer);yield*e.append(t)}function*A(e,n){const t=new Uint8Array(new Int32Array([n]).buffer);yield*e.append(t)}function*h(e,n){const t=new Uint8Array(new Uint16Array([n]).buffer);yield*e.append(t)}function*g(e,n){const t=new Uint8Array(new Int16Array([n]).buffer);yield*e.append(t)}function*w(e,n){const t=new Uint8Array([n]);yield*e.append(t)}function*U(e,n){const t=new Uint8Array(new Int8Array([n]).buffer);yield*e.append(t)}function*b(e,n){const t=new Uint8Array([Number(n)]);yield*e.append(t)}function*m(e,n){const t=n.entries();yield*u(e,n.size);for(const[n,r]of t)yield*u(e,n),yield*u(e,r)}function*I(e,n){yield*u(e,n.size);for(const t of n)yield*u(e,t)}function*z(e,n){yield*y(e,n.getTime())}function*v(e,n){yield*c(e,n.name),yield*c(e,n.message),yield*c(e,n.stack)}function*B(e,n){yield*c(e,n.source),yield*c(e,n.flags)}class N{constructor(){this.offset=0,this.value=new Uint8Array(0)}*consume(e){if(this.offset+e>this.value.length){const n=this.value.subarray(this.offset,this.value.length),t=yield;return this.value=new Uint8Array(n.length+t.length),this.value.set(n),this.value.set(t,n.length),this.offset=0,yield*this.consume(e)}{const n=this.value.slice(this.offset,this.offset+e);return this.offset+=n.length,n}}}function*x(e){const n=(yield*e.consume(1))[0],t=r[n].parse;return yield*t(e)}function*E(e){const n=yield*x(e),t={};for(let r=0;r<n;r++){const n=yield*S(e),r=yield*x(e);t[n]=r}return t}function*F(e){const n=yield*x(e),t=[];for(let r=0;r<n;r++)t.push(yield*x(e));return t}function*S(e){const n=yield*x(e),r=yield*e.consume(n);return t.decode(r)}function*j(e){const n=yield*x(e),t=yield*e.consume(8*n);return new BigUint64Array(t.buffer)}function*T(e){const n=yield*x(e),t=yield*e.consume(8*n);return new BigInt64Array(t.buffer)}function*D(e){const n=yield*x(e),t=yield*e.consume(8*n);return new Float64Array(t.buffer)}function*M(e){const n=yield*x(e),t=yield*e.consume(4*n);return new Float32Array(t.buffer)}function*O(e){const n=yield*x(e),t=yield*e.consume(4*n);return new Uint32Array(t.buffer)}function*R(e){const n=yield*x(e),t=yield*e.consume(4*n);return new Int32Array(t.buffer)}function*C(e){const n=yield*x(e),t=yield*e.consume(2*n);return new Uint16Array(t.buffer)}function*k(e){const n=yield*x(e),t=yield*e.consume(2*n);return new Int16Array(t.buffer)}function*P(e){const n=yield*x(e),t=yield*e.consume(n);return new Uint8ClampedArray(t.buffer)}function*V(e){const n=yield*x(e);return yield*e.consume(n)}function*_(e){const n=yield*x(e),t=yield*e.consume(n);return new Int8Array(t.buffer)}function*q(e){const n=yield*e.consume(8);return new Float64Array(n.buffer)[0]}function*G(e){const n=yield*e.consume(8);return new BigInt64Array(n.buffer)[0]}function*H(e){const n=yield*e.consume(4);return new Uint32Array(n.buffer)[0]}function*J(e){const n=yield*e.consume(4);return new Int32Array(n.buffer)[0]}function*K(e){const n=yield*e.consume(2);return new Uint16Array(n.buffer)[0]}function*L(e){const n=yield*e.consume(2);return new Int16Array(n.buffer)[0]}function*Q(e){const n=yield*e.consume(1);return new Uint8Array(n.buffer)[0]}function*W(e){const n=yield*e.consume(1);return new Int8Array(n.buffer)[0]}function*X(){}function*Y(){return null}function*Z(){return NaN}function*$(e){const n=yield*e.consume(1);return Boolean(n[0])}function*ee(e){const n=yield*x(e),t=new Map;for(let r=0;r<n;r++){const n=yield*x(e),r=yield*x(e);t.set(n,r)}return t}function*ne(e){const n=yield*x(e),t=new Set;for(let r=0;r<n;r++){const n=yield*x(e);t.add(n)}return t}function*te(e){const n=yield*q(e);return new Date(n)}function*re(e){const n=yield*S(e),t=yield*S(e),r=yield*S(e),i=new Error(t);return i.name=n,i.stack=r,i}function*ie(e){const n=yield*S(e),t=yield*S(e);return new RegExp(n,t)}function se(e){return e===Object(e)}function oe(e){return"number"==typeof e.length}function ue(e){return"string"==typeof e}function ae(e){return e instanceof BigUint64Array}function fe(e){return e instanceof BigInt64Array}function ce(e){return e instanceof Float64Array}function le(e){return e instanceof Uint32Array}function ye(e){return e instanceof Int32Array}function de(e){return e instanceof Uint16Array}function pe(e){return e instanceof Float32Array}function Ae(e){return e instanceof Int16Array}function he(e){return e instanceof Uint8ClampedArray}function ge(e){return e instanceof Uint8Array}function we(e){return e instanceof Int8Array}function Ue(e){return"number"==typeof e}function be(e){return"bigint"==typeof e}function me(e){return xe(e)&&e>=0&&e<=4294967295}function Ie(e){return xe(e)&&e>=-2147483648&&e<=2147483647}function ze(e){return xe(e)&&e>=0&&e<=65535}function ve(e){return xe(e)&&e>=-32768&&e<=32767}function Be(e){return xe(e)&&e>=0&&e<=255}function Ne(e){return xe(e)&&e>=-128&&e<=127}function xe(e){return Ue(e)&&e==Number.parseInt(e,10)}function Ee(e){return void 0===e}function Fe(e){return null===e}function Se(e){return Number.isNaN(e)}function je(e){return"boolean"==typeof e}function Te(e){return e instanceof Map}function De(e){return e instanceof Set}function Me(e){return e instanceof Date}function Oe(e){return e instanceof Error}function Re(e){return e instanceof RegExp}e.getParser=function(){const e=function*(){return yield*x(new N)}();return e.next(),e},e.getSerializer=function*(e,{chunkSize:n=8388608}={}){const t=new o(n);yield*u(t,e),t.pending&&(yield*t.append(new Uint8Array([]))),t.offset&&(yield t.value.subarray(0,t.offset))},e.parseArray=F,e.parseBigInt=G,e.parseBigInt64Array=T,e.parseBigUint64Array=j,e.parseBoolean=$,e.parseDate=te,e.parseError=re,e.parseFloat32Array=M,e.parseFloat64Array=D,e.parseInt16=L,e.parseInt16Array=k,e.parseInt32=J,e.parseInt32Array=R,e.parseInt8=W,e.parseInt8Array=_,e.parseMap=ee,e.parseNaN=Z,e.parseNull=Y,e.parseNumber=q,e.parseObject=E,e.parseRegExp=ie,e.parseSet=ne,e.parseString=S,e.parseUint16=K,e.parseUint16Array=C,e.parseUint32=H,e.parseUint32Array=O,e.parseUint8=Q,e.parseUint8Array=V,e.parseUint8ClampedArray=P,e.parseUndefined=X,e.parseValue=x,e.registerType=s,e.serializeArray=f,e.serializeBigInt=d,e.serializeBoolean=b,e.serializeDate=z,e.serializeError=v,e.serializeInt16=g,e.serializeInt32=A,e.serializeInt8=U,e.serializeMap=m,e.serializeNumber=y,e.serializeObject=a,e.serializeRegExp=B,e.serializeSet=I,e.serializeString=c,e.serializeTypedArray=l,e.serializeUint16=h,e.serializeUint32=p,e.serializeUint8=w,e.serializeValue=u,e.testArray=oe,e.testBigInt=be,e.testBigInt64Array=fe,e.testBigUint64Array=ae,e.testBoolean=je,e.testDate=Me,e.testError=Oe,e.testFloat32Array=pe,e.testFloat64Array=ce,e.testInt16=ve,e.testInt16Array=Ae,e.testInt32=Ie,e.testInt32Array=ye,e.testInt8=Ne,e.testInt8Array=we,e.testInteger=xe,e.testMap=Te,e.testNaN=Se,e.testNull=Fe,e.testNumber=Ue,e.testObject=se,e.testRegExp=Re,e.testSet=De,e.testString=ue,e.testUint16=ze,e.testUint16Array=de,e.testUint32=me,e.testUint32Array=le,e.testUint8=Be,e.testUint8Array=ge,e.testUint8ClampedArray=he,e.testUndefined=Ee,Object.defineProperty(e,"__esModule",{value:!0})}));
