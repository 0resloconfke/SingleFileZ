!function(){"use strict";const n=[0],e=Symbol(),t=new TextEncoder,r=new TextDecoder,i=new Array(256);let o=0;function u(e,t,r,u){if(void 0===u){if(o++,!(i.length-o>=n.length))throw new Error("Reached maximum number of custom types");i[i.length-o]={serialize:e,parse:t,test:r}}else i[u]={serialize:e,parse:t,test:r}}function*c(n,e){const t=i.findIndex((({test:t}={})=>t&&t(e,n)));n.addObject(e),yield*n.append(new Uint8Array([t]));const r=i[t].serialize;r&&(yield*r(n,e)),0!=t&&g(e)&&(yield*function*(n,e){const t=Object.getOwnPropertySymbols(e).map((n=>[n,e[n]]));yield*f(n,t)}(n,e),yield*function*(n,e){let t=Object.entries(e);h(e)&&(t=t.filter((([n])=>!O(Number(n)))));yield*function*(n,e){yield*c(n,e.length);for(const[t,r]of e)yield*s(n,t),yield*c(n,r)}(n,t)}(n,e))}function*f(n,t){yield*c(n,t.length);const r=Object.keys(t).filter((n=>O(Number(n)))).map((n=>Number(n)));let i=0,o=r[i];for(const[u,f]of t.entries())o==u?(o=r[++i],yield*c(n,f)):yield*c(n,e)}function*s(n,e){const r=t.encode(e);yield*c(n,r.length),yield*n.append(r)}function*a(n,e){yield*c(n,e.length),yield*n.append(new Uint8Array(e.buffer))}function*l(n,e){const t=new Uint8Array(new Float64Array([e]).buffer);yield*n.append(t)}function*y(n,e){const t=new Uint8Array([Number(e)]);yield*n.append(t)}u((function*(n,e){const t=n.objects.indexOf(e);yield*c(n,t)}),(function*(n){const e=yield*w(n);return new d(e,n)}),(function(n,e){return g(n)&&e.objects.includes(n)}),0),u(null,(function*(){return{}}),g),u(f,b,h),u(s,m,(function(n){return"string"==typeof n})),u(a,(function*(n){const e=yield*w(n),t=yield*n.consume(8*e);return new BigUint64Array(t.buffer)}),(function(n){return n instanceof BigUint64Array})),u(a,(function*(n){const e=yield*w(n),t=yield*n.consume(8*e);return new BigInt64Array(t.buffer)}),(function(n){return n instanceof BigInt64Array})),u(a,(function*(n){const e=yield*w(n),t=yield*n.consume(8*e);return new Float64Array(t.buffer)}),(function(n){return n instanceof Float64Array})),u(a,(function*(n){const e=yield*w(n),t=yield*n.consume(4*e);return new Float32Array(t.buffer)}),(function(n){return n instanceof Float32Array})),u(a,(function*(n){const e=yield*w(n),t=yield*n.consume(4*e);return new Uint32Array(t.buffer)}),(function(n){return n instanceof Uint32Array})),u(a,(function*(n){const e=yield*w(n),t=yield*n.consume(4*e);return new Int32Array(t.buffer)}),(function(n){return n instanceof Int32Array})),u(a,(function*(n){const e=yield*w(n),t=yield*n.consume(2*e);return new Uint16Array(t.buffer)}),(function(n){return n instanceof Uint16Array})),u(a,(function*(n){const e=yield*w(n),t=yield*n.consume(2*e);return new Int16Array(t.buffer)}),(function(n){return n instanceof Int16Array})),u(a,(function*(n){const e=yield*w(n),t=yield*n.consume(e);return new Uint8ClampedArray(t.buffer)}),(function(n){return n instanceof Uint8ClampedArray})),u(a,(function*(n){const e=yield*w(n);return yield*n.consume(e)}),(function(n){return n instanceof Uint8Array})),u(a,(function*(n){const e=yield*w(n),t=yield*n.consume(e);return new Int8Array(t.buffer)}),(function(n){return n instanceof Int8Array})),u((function*(n,e){yield*c(n,e.byteLength),yield*n.append(new Uint8Array(e))}),(function*(n){const e=yield*w(n);return(yield*n.consume(e)).buffer}),(function(n){return n instanceof ArrayBuffer})),u(l,p,I),u((function*(n,e){const t=new Uint8Array(new BigInt64Array([e]).buffer);yield*n.append(t)}),(function*(n){const e=yield*n.consume(8);return new BigInt64Array(e.buffer)[0]}),(function(n){return"bigint"==typeof n})),u((function*(n,e){const t=new Uint8Array(new Uint32Array([e]).buffer);yield*n.append(t)}),(function*(n){const e=yield*n.consume(4);return new Uint32Array(e.buffer)[0]}),(function(n){return O(n)&&n>=0&&n<=4294967295})),u((function*(n,e){const t=new Uint8Array(new Int32Array([e]).buffer);yield*n.append(t)}),(function*(n){const e=yield*n.consume(4);return new Int32Array(e.buffer)[0]}),(function(n){return O(n)&&n>=-2147483648&&n<=2147483647})),u((function*(n,e){const t=new Uint8Array(new Uint16Array([e]).buffer);yield*n.append(t)}),(function*(n){const e=yield*n.consume(2);return new Uint16Array(e.buffer)[0]}),(function(n){return O(n)&&n>=0&&n<=65535})),u((function*(n,e){const t=new Uint8Array(new Int16Array([e]).buffer);yield*n.append(t)}),(function*(n){const e=yield*n.consume(2);return new Int16Array(e.buffer)[0]}),(function(n){return O(n)&&n>=-32768&&n<=32767})),u((function*(n,e){const t=new Uint8Array([e]);yield*n.append(t)}),(function*(n){const e=yield*n.consume(1);return new Uint8Array(e.buffer)[0]}),(function(n){return O(n)&&n>=0&&n<=255})),u((function*(n,e){const t=new Uint8Array(new Int8Array([e]).buffer);yield*n.append(t)}),(function*(n){const e=yield*n.consume(1);return new Int8Array(e.buffer)[0]}),(function(n){return O(n)&&n>=-128&&n<=127})),u(null,(function*(){return}),(function(n){return void 0===n})),u(null,(function*(){return null}),(function(n){return null===n})),u(null,(function*(){return NaN}),(function(n){return Number.isNaN(n)})),u(y,A,(function(n){return"boolean"==typeof n})),u((function*(n,e){yield*s(n,e.description)}),(function*(n){const e=yield*m(n);return Symbol(e)}),(function(n){return"symbol"==typeof n})),u(null,(function*(){return e}),U),u((function*(n,e){const t=e.entries();yield*c(n,e.size);for(const[e,r]of t)yield*c(n,e),yield*c(n,r)}),(function*(n){const e=yield*w(n),t=new Map;for(let r=0;r<e;r++){const e=yield*w(n),r=yield*w(n);n.setObject([e,r],((n,e)=>t.set(n,e)))}return t}),(function(n){return n instanceof Map})),u((function*(n,e){yield*c(n,e.size);for(const t of e)yield*c(n,t)}),(function*(n){const e=yield*w(n),t=new Set;for(let r=0;r<e;r++){const e=yield*w(n);n.setObject([e],(n=>t.add(n)))}return t}),(function(n){return n instanceof Set})),u((function*(n,e){yield*l(n,e.getTime())}),(function*(n){const e=yield*p(n);return new Date(e)}),(function(n){return n instanceof Date})),u((function*(n,e){yield*s(n,e.message),yield*s(n,e.stack)}),(function*(n){const e=yield*m(n),t=yield*m(n),r=new Error(e);return r.stack=t,r}),(function(n){return n instanceof Error})),u((function*(n,e){yield*s(n,e.source),yield*s(n,e.flags)}),(function*(n){const e=yield*m(n),t=yield*m(n);return new RegExp(e,t)}),(function(n){return n instanceof RegExp})),u((function*(n,e){yield*s(n,e.valueOf())}),(function*(n){return new String(yield*m(n))}),(function(n){return n instanceof String})),u((function*(n,e){yield*l(n,e.valueOf())}),(function*(n){return new Number(yield*p(n))}),(function(n){return n instanceof Number})),u((function*(n,e){yield*y(n,e.valueOf())}),(function*(n){return new Boolean(yield*A(n))}),(function(n){return n instanceof Boolean}));class d{constructor(n,e){this.index=n,this.data=e}getObject(){return this.data.objects[this.index]}}function*w(n){const e=(yield*n.consume(1))[0],t=i[e].parse,r=n.getObjectId(),o=yield*t(n);return 0!=e&&g(o)&&(yield*function*(n,e){const t=yield*b(n);n.setObject([t],(n=>n.forEach((([n,t])=>e[n]=t))))}(n,o),yield*function*(n,e){yield*function*(n,e){const t=yield*w(n);for(let r=0;r<t;r++){const t=yield*m(n),r=yield*w(n);n.setObject([r],(n=>e[t]=n))}}(n,e)}(n,o)),n.resolveObject(r,o),o}function*b(n){const e=yield*w(n),t=new Array(e);for(let r=0;r<e;r++){const e=yield*w(n);U(e)||n.setObject([e],(n=>t[r]=n))}return t}function*m(n){const e=yield*w(n),t=yield*n.consume(e);return r.decode(t)}function*p(n){const e=yield*n.consume(8);return new Float64Array(e.buffer)[0]}function*A(n){const e=yield*n.consume(1);return Boolean(e[0])}function g(n){return n===Object(n)}function h(n){return"number"==typeof n.length}function U(n){return n===e}function I(n){return"number"==typeof n}function O(n){return I(n)&&Number.isInteger(n)}const j="single-filez-response-fetch";let v=new Map;function B(n){return new Promise(((e,t)=>{var r,i,o,u;r=new CustomEvent("single-filez-request-fetch",{detail:n}),window.dispatchEvent(r),i=j,o=function r(i){var o,u,c;i.detail?i.detail.url==n&&(o=j,u=r,c=!1,window.removeEventListener(o,u,c),i.detail.response?e({status:i.detail.status,headers:new Map(i.detail.headers),arrayBuffer:async()=>i.detail.response}):t(i.detail.error)):t()},u=!1,window.addEventListener(i,o,u)}))}browser.runtime.onMessage.addListener((n=>"singlefile.fetchFrame"==n.method&&window.frameId&&window.frameId==n.frameId?async function(n){try{let r=await(e=n.url,t={cache:"force-cache",headers:n.headers},window.fetch(e,t));return 401!=r.status&&403!=r.status&&404!=r.status||(r=await Promise.race([B(n.url),new Promise(((n,e)=>setTimeout((()=>e()),5e3)))])),{status:r.status,headers:[...r.headers],array:Array.from(new Uint8Array(await r.arrayBuffer()))}}catch(n){return{error:n&&n.toString()}}var e,t}(n):"singlefile.fetchResponse"==n.method?async function(n){let e=v.get(n.requestId);if(e){const t=e.parser.next(n.data);if(t.done){v.delete(n.requestId);const r=t.value;r.error?e.reject(new Error(r.error)):e.resolve({status:r.status,headers:{get:n=>r.headers&&r.headers[n]},arrayBuffer:async()=>r.array.buffer})}}return{}}(n):void 0))}();
